---
description: 本项目中前端、ca_web和ca之间的架构以及主要功能
globs: 
alwaysApply: false
---
# libpki项目架构

## 整体架构

libpki项目采用三层架构:

1. **前端层**: Vue3实现的Web管理界面 (位于`webui/src`目录)
2. **中间层**: ca_web后端服务 (主体在`ca_web.c`文件)
3. **核心层**: CA本体 (主体在`server/ca-server/ca.c`文件)

## 通信机制

```
Vue3前端 <--HTTP API--> ca_web后端 <--Socket通信--> CA本体服务
```

- **前端与ca_web**: 通过HTTP请求/响应进行通信 (端口8888)
- **ca_web与CA本体**: 通过Socket进行通信 (端口8001)

## 数据流向

1. 用户在Vue3前端界面操作
2. 前端通过HTTP API请求ca_web后端服务
3. ca_web将请求转换为特定协议，通过Socket发送给CA本体
4. CA本体处理请求，将结果返回给ca_web
5. ca_web将结果转换为JSON格式，返回给前端

## 主要组件详解

### Vue3前端 (webui/src)

前端提供用户管理界面，包括:
- 用户证书管理
- 证书撤销列表(CRL)管理
- 其他PKI相关操作

关键组件:
- [CRLList.vue](mdc:webui/src/components/CRLList.vue): 证书撤销列表展示组件

### ca_web后端 (ca_web.c)

作为中间层，主要职责:
1. 提供HTTP API供前端调用
2. 与CA本体服务通过Socket通信
3. 数据格式转换(JSON <-> 二进制协议)

主要API端点:
- `/api/users`: 获取用户列表
- `/api/users/{user_id}/certificate`: 获取特定用户证书
- `/api/crl`: 获取证书撤销列表

### CA本体 (server/ca-server/ca.c)

核心服务，负责:
1. 证书的生成、更新和撤销
2. 证书撤销列表(CRL)的管理
3. 用户数据的管理

关键函数:
- `handle_web_client()`: 处理来自ca_web的请求
- `handle_web_get_users()`: 处理获取用户列表的请求
- `handle_web_get_cert()`: 处理获取证书的请求
- `handle_web_get_crl()`: 处理获取CRL的请求

## 通信协议

ca_web与CA本体之间使用二进制协议通信，主要命令:
- `WEB_CMD_GET_USERS (0x81)`: 请求用户列表
- `WEB_CMD_USER_LIST (0x82)`: 返回用户列表
- `WEB_CMD_GET_CERT (0x83)`: 请求特定用户证书
- `WEB_CMD_CERT_DATA (0x84)`: 返回证书数据
- `WEB_CMD_GET_CRL (0x85)`: 请求证书撤销列表
- `WEB_CMD_CRL_DATA (0x86)`: 返回CRL数据
